$(function(){var x=/^(\d{4})-(0\d{1}|1[0-2])-(0\d{1}|[12]\d{1}|3[01])$/;var t=/^(\d{4})-(0\d{1}|1[0-2])-(0\d{1}|[12]\d{1}|3[01])\s(0\d{1}|1\d{1}|2[0-3]):([0-5]\d{1})$/;var u=/^(\d{4})-(0\d{1}|1[0-2])-(0\d{1}|[12]\d{1}|3[01])\s(0\d{1}|1\d{1}|2[0-3]):([0-5]\d{1}):([0-5]\d{1})$/;var v=$("body");var z={isRange:false,format:"YYYY-MM-DD hh:mm:ss",minDate:"",maxDate:"",show:function(){},hide:function(){},beforeHide:function(){},chooseDay:function(){}};var e=D();var C='<div class="timeRangePicker-wrap">{{item}}</div>';var G='<div class="timePicker-nav" data-timepicker=""><span class="timePicker-prev"><</span><span class="timePicker-year">{{year}}年</span><span class="timePicker-month">{{month}}月</span><span class="timePicker-day">{{day}}日</span><span class="timePicker-next">></span></div><div class="timePicker-content timePicker-content-date"><div class="timePicker-day-main timePicker-main "><div class="timePicker-day-title-list clearfix"><div class="timePicker-item">日</div><div class="timePicker-item">一</div><div class="timePicker-item">二</div><div class="timePicker-item">三</div><div class="timePicker-item">四</div><div class="timePicker-item">五</div><div class="timePicker-item">六</div></div><div class="timePicker-day-list clearfix">{{dayItem}}</div></div><div class="timePicker-month-main timePicker-main hide"><div class="timePicker-month-list clearfix">{{monthItem}}</div></div><div class="timePicker-year-main timePicker-main hide"><div class="timePicker-year-list clearfix">{{yearItem}}</div></div></div><div class="timePicker-footer timePicker-time-main "><div class="timePicker-main clearfix">时间：<div class="timePicker-hour-main"><div class="timePicker-hour-list-main timePicker-dropDown-main"><div class="timePicker-item timePicker-select"><span>&nbsp;</span><img src="http://img.yi114.com/201682102710_triangle.png" class="timePicker-triangle"></div><div class="timePicker-hour-list hide clearfix" role="list">'+e.h+'</div></div>时</div><div class="timePicker-minute-main"><div class="timePicker-minute-list-main timePicker-dropDown-main"><div class="timePicker-item timePicker-select"><span>&nbsp;</span><img src="http://img.yi114.com/201682102710_triangle.png" class="timePicker-triangle"></div><div class="timePicker-minute-list hide clearfix" role="list">'+e.m+'</div></div>分</div><div class="timePicker-second-main"><div class="timePicker-second-list-main timePicker-dropDown-main"><div class="timePicker-item timePicker-select"><span>&nbsp;</span><img src="http://img.yi114.com/201682102710_triangle.png" class="timePicker-triangle"></div><div class="timePicker-second-list hide clearfix" role="list">'+e.s+'</div></div>秒</div></div></div><div class="timePicker-footer"><a href="javascript:;" class="timePicker-btn timePicker-clean">清空</a><a href="javascript:;" class="timePicker-btn timePicker-confirm">确定</a></div>';function h(K,J){if(!K.length){return false}this.target=K;this.options=$.extend({},z,J);if(f(this.options.minDate,this.options.maxDate)){this.options.maxDate=""}this.maxDate=o(this.options.maxDate);this.minDate=o(this.options.minDate);this.init();this.event()}h.prototype={init:function(){var L=this.target.find('[role="timePicker"]');var M=B.call(this,L.eq(0));var N=M.time;var J={};J.begin=M;if(this.options.isRange){var K=B.call(this,L.eq(1));N=N+";"+K.time;J.end=K}J.time=N;this.target.data("time",J);this.target.data("object",this);this.target.css("position","relative")},renderYear:function(L,P){L=(L===0||L===1)?L:c.call(this).index;P=P||Number(this.getDate()[L].year);var N="";var O="y-next";var Q="y-prev";var M=P-6;var J=P+3;if(this.maxDate){if(P+4>this.maxDate.year){O="";J=this.maxDate.year<=this.minDate.year?this.minDate.year:this.maxDate.year}}if(this.minDate){if(P-7<this.minDate.year){Q="";M=this.minDate.year>=this.maxDate.year?this.maxDate.year:this.minDate.year}}var K=P-7;for(;K<M;K++){N+='<div class="timePicker-item timePicker-disable '+Q+'">'+K+"</div>"}for(;K<=J;K++){N+='<div class="timePicker-item">'+K+"</div>"}for(;K<=P+4;K++){N+='<div class="timePicker-item timePicker-disable '+O+'">'+K+"</div>"}return N},renderMonth:function(M){M=(M===0||M===1)?M:c.call(this).index;var L=this.getDate()[M];var P=L.year;var Q=L.month;var O="";var N=0;var J=12;if(this.maxDate){if(P>this.maxDate.year){J=0}if(P==this.maxDate.year){J=Number(this.maxDate.month)}}if(this.minDate){if(P<this.minDate.year){N=12}if(P==this.minDate.year){N=Number(this.minDate.month)-1}}var K=0;for(;K<N;K++){O+='<div class="timePicker-item timePicker-disable">'+(K+1)+"</div>"}for(;K<J;K++){O+='<div class="timePicker-item">'+(K+1)+"</div>"}for(;K<12;K++){O+='<div class="timePicker-item timePicker-disable">'+(K+1)+"</div>"}return O},renderDate:function(K,ac){K=(K===0||K===1)?K:c.call(this).index;var J=this.getDate()[K];var ad=J.month;var aa=J.day;var M=J.year;ac=new Date(J.time);var ae=new Date(ac.setDate(1));var P=ae.getDay();var N=M/4===0?29:28;var ab=[31,N,31,30,31,30,31,31,30,31,30,31];var R=ab[b(ad-1)];var O=ab[b(ad-2)];var T=ab[Number(ad)];var L="";var X=1;var U="timePicker-next";var S="timePicker-prev";var V=0;var Z=R;if(this.minDate){if(M<this.minDate.year){S="";V=R}if(M==this.minDate.year&&ad<=this.minDate.month){S="";V=this.minDate.day-1}}if(this.maxDate){if(M>this.maxDate.year){U="";Z=0}if(M==this.maxDate.year&&ad>=this.maxDate.month){U="";Z=this.maxDate.day}}for(var Y=0;Y<P;Y++){L+='<div class="timePicker-item timePicker-disable '+S+'">'+(O-P+Y+1)+"</div>"}var W=0;for(;W<V;W++){L+='<div class="timePicker-item timePicker-disable">'+(W+1)+"</div>"}for(;W<Z;W++){L+='<div class="timePicker-item">'+(W+1)+"</div>"}for(;W<R;W++){L+='<div class="timePicker-item timePicker-disable">'+(W+1)+"</div>"}for(var Q=P+R;Q<42;Q++){L+='<div class="timePicker-item timePicker-disable '+U+'">'+X+"</div>";X++}return L},event:function(){var J=this;v.off("click",".timePicker-next,.timePicker-prev").on("click",".timePicker-next,.timePicker-prev",function(L){var N=$(this);var O=$(".timeRangePicker-wrap").data("object");var K=c.call(O).date;var M=K.month;if(N.hasClass("timePicker-prev")){M=M-2}if(M<0){I.call(O,K.year-1,"year",true,false);I.call(O,12,"month",true);O.updateRenderPicker();return}if(M>11){I.call(O,Number(K.year)+1,"year",true,false);I.call(O,1,"month",true);O.updateRenderPicker();return}$(".timePicker-month-list .timePicker-item").eq(q(M)).trigger("click")});v.off("click",".timePicker-day-list .timePicker-item").on("click",".timePicker-day-list .timePicker-item",function(K){var L=$(this);var M=$(".timeRangePicker-wrap").data("object");if(L.hasClass("timePicker-disable")){return false}H(L);I.call(M,L,"day");M.options.chooseDay.call(M,L)});v.off("click",".timePicker-month-list .timePicker-item").on("click",".timePicker-month-list .timePicker-item",function(L){var M=$(this);var N=$(".timeRangePicker-wrap").data("object");var K="";if(M.hasClass("timePicker-disable")){return false}H(M);a.call(N,"day");I.call(N,M,"month");K=N.renderDate();$(".timePicker-day-list").html(K);w.call(N,"day")});v.off("click",".timePicker-year-list .timePicker-item").on("click",".timePicker-year-list .timePicker-item",function(M){var N=$(this);var O=$(".timeRangePicker-wrap").data("object");if(N.hasClass("timePicker-disable")){var L=Number(N.text());if(N.hasClass("y-prev")){L=L-3}else{if(N.hasClass("y-next")){L=L+6}else{return}}var K=O.renderYear(0,L);$(".timePicker-year-list").html(K);w.call(O,"year");return false}H(N);a.call(O,"day");I.call(O,N,"year");O.updateRenderPicker()});v.off("click",".timePicker-hour-list .timePicker-item").on("click",".timePicker-hour-list .timePicker-item",function(K){if($(this).hasClass("timePicker-disable")){return false}var L=$(".timeRangePicker-wrap").data("object");$(this).parents(".timePicker-hour-list").find(".timePicker-item.active").removeClass("active");$(this).addClass("active");I.call(L,$(this),"hour")});v.off("click",".timePicker-minute-list .timePicker-item").on("click",".timePicker-minute-list .timePicker-item",function(K){if($(this).hasClass("timePicker-disable")){return false}var L=$(".timeRangePicker-wrap").data("object");$(this).addClass("active").siblings(".timePicker-item").removeClass("active");I.call(L,$(this),"minute")});v.off("click",".timePicker-second-list .timePicker-item").on("click",".timePicker-second-list .timePicker-item",function(K){if($(this).hasClass("timePicker-disable")){return false}var L=$(".timeRangePicker-wrap").data("object");$(this).addClass("active").siblings(".timePicker-item").removeClass("active");I.call(L,$(this),"second")});v.off("click",".timePicker-year").on("click",".timePicker-year",function(K){var L=$(".timeRangePicker-wrap").data("object");L.updateRenderPicker();$(".timeRangePicker-wrap .timePicker-time-main").addClass("hide");a.call(L,"year")});v.off("click",".timePicker-month").on("click",".timePicker-month",function(K){var L=$(".timeRangePicker-wrap").data("object");$(".timeRangePicker-wrap .timePicker-time-main").addClass("hide");a.call(L,"month")});v.off("click",".timePicker-day").on("click",".timePicker-day",function(K){var L=$(".timeRangePicker-wrap").data("object");$(".timeRangePicker-wrap .timePicker-time-main").removeClass("hide");a.call(L,"day")});this.target.on("click",'[role="timePicker"]',function(M){M.stopPropagation();var K=J.target.data("target");var N=J.target.find('[role="timePicker"]').index($(this));var L=J.target.find(".timeRangePicker-wrap").length;if((!J.options.isRange&&N>=1)||N>1){return false}if(!L||((K===0||K===1)&&(K!=N))){J.hidePicker()}if(!$(".timeRangePicker-wrap").length){J.showPicker($(this))}});v.off("click",".timeRangePicker-wrap").on("click",".timeRangePicker-wrap",function(K){K.stopPropagation()});v.off("click.hidePicker").on("click.hidePicker",function(K){p()});v.off("click.timePickerConfirm").on("click.timePickerConfirm",".timePicker-confirm",function(K){p()});v.off("click.timePickerClean").on("click.timePickerClean",".timePicker-clean",function(K){var L=$(".timeRangePicker-wrap").data("object");L.target.find('[role="timePicker"]').val("")});this.target.on("keyup",'[role="timePicker"]',function(K){J.updatePicker($(this))});v.off("click.dropDown",".timePicker-dropDown-main .timePicker-select").on("click.dropDown",".timePicker-dropDown-main .timePicker-select",function(K){var M=$(this);var L=M.parents(".timePicker-dropDown-main");$(".timePicker-dropDown-main").not(L).find('[role="list"]').addClass("hide");L.find('[role="list"]').toggleClass("hide")});v.off("click.dropDown",'.timePicker-dropDown-main [role="list"] .timePicker-item').on("click.dropDown",'.timePicker-dropDown-main [role="list"] .timePicker-item',function(L){var N=$(this);var M=N.parents(".timePicker-dropDown-main");var K=M.find(".timePicker-select span");K.html(N.text());$(".timePicker-dropDown-main").find('[role="list"]').addClass("hide")})},showPicker:function(M){d.call(this);var K=this.target.find('[role="timePicker"]').index(M);var J=this.getDate()[K];var L=G.replace("{{dayItem}}",this.renderDate(K)).replace("{{monthItem}}",this.renderMonth(K)).replace("{{yearItem}}",this.renderYear(K)).replace("{{month}}",J.month).replace("{{year}}",J.year).replace("{{day}}",J.day);L=C.replace("{{item}}",L);this.target.append(L);g.call(this,J);if(A(this.options.format)===1){$(".timeRangePicker-wrap .timePicker-time-main").remove()}if(A(this.options.format)===2){$(".timeRangePicker-wrap .timePicker-second-main").remove()}this.target.data("target",K);m.call(this);K=this.target.find('[role="timePicker"]').index(M);if(K===-1){return}this.target.data("target",K);w.call(this);$(".timeRangePicker-wrap").data("object",this.target.data("object"));this.options.show(this.target,K)},hidePicker:function(){var L=this;L.options.beforeHide(L.target);var K=c.call(this);var J=K.$target;i.call(L,J);L.target.data("target","");v.find(".timeRangePicker-wrap").remove();L.options.hide(L.target)},updatePicker:function(){var S=c.call(this);var O=S.$target.val();var N=S.index;var P=["begin","end"];var K=P[N];var M=JSON.parse(JSON.stringify(S.time));var L=this.target.find('[role="timePicker"]');if(!j(O)){return false}var R=o(O);M[K]=R;var J=S.time.time.split(";");J[N]=R.time;var Q=y.call(this,M[K]).isUpdate;if(this.options.isRange){if(f(J[0],J[1])&&O&&L.eq(1-N).val()){L.eq(1-N).val(O);M=r.call(this,R,M)}M.time=J.join(";")}else{M.time=M[K].time}M=k.call(this,M);this.target.data("time",M);if(Q){this.updateRenderPicker();L.eq(N).val(M[K].time)}},getDate:function(){var J=this.target.data("time").time;if(this.options.isRange){return F(J)}return[o(J)]},updateRenderPicker:function(){var J=c.call(this);var K=J.date;var L=G.replace("{{dayItem}}",this.renderDate(J.index)).replace("{{monthItem}}",this.renderMonth(J.index)).replace("{{yearItem}}",this.renderYear(J.index)).replace("{{month}}",K.month).replace("{{year}}",K.year).replace("{{day}}",K.day);$(".timeRangePicker-wrap").html(L);w.call(this);if(A(this.options.format)===1){$(".timeRangePicker-wrap .timePicker-time-main").remove()}if(A(this.options.format)===2){$(".timeRangePicker-wrap .timePicker-second-main").remove()}}};function p(){var J=$(".timeRangePicker-wrap").data("object");if(J){J.hidePicker()}}function i(K){var J,N;for(var M=0;M<K.length;M++){J=c.call(this,M);N=K.eq(M).val();if(N&&!j(N)){var L=A(this.options.format)===0?J.date.time:J.date.time.split(" ")[0];K.eq(M).val(L)}}}function q(J){J=J<0?0:J;J=J>11?11:J;return J}function b(J){J=Number(J);J=J<0?11:J;J=J>11?0:J;return J}function d(){var P=this;var K=["begin","end"];var O=JSON.parse(JSON.stringify(this.target.data("time")));var N=this.target.find('[role="timePicker"]');var L=[];var J=l();if(this.options.isRange){var M=O.time.split(";");$.each(N,function(R,S){var Q=B.call(P,$(S));L.push(Q.time)});O.time=L.join(";");this.target.data("time",O);return}if(!N.val()){O.begin=J;O.time=J}}function B(K){var L=K.val();var M=j(L);var J=M?o(L):l();L=y.call(this,J).time;return L}function k(J){J=JSON.parse(JSON.stringify(J));if(this.options.isRange){J.begin=y.call(this,J.begin).time;J.end=y.call(this,J.end).time;J.time=J.begin.time+";"+J.end.time}else{J.begin=y.call(this,J.begin).time;J.time=J.begin.time}return J}function y(K){var J;if(this.maxDate&&f(K.time,this.maxDate.time)){K=this.maxDate;J=1}if(this.minDate&&f(this.minDate.time,K.time)){K=this.minDate;J=1}return{time:K,isUpdate:J}}function j(J){return t.test(J)||x.test(J)||u.test(J)}function A(K){var J=0;switch(K){case"YYYY-MM-DD":J=1;break;case"YYYY-MM-DD hh:mm":J=2;break}return J}function m(){var M=this.target.outerHeight();var J=this.target.data("target");var K=this.target.find('[role="timePicker"]').eq(J);var L=K.offset().left-this.target.offset().left;$(".timeRangePicker-wrap").css({top:M,left:L})}function n(O,N){var M={year:"年",month:"月",day:"日"};var J=N?[N]:["year","month","day"];var L;for(var K=0;K<J.length;K++){L=J[K];$(".timePicker-"+L).text(O[L]+M[L])}}function I(O,N,Q,K){var J=c.call(this);var L=J.key;var P=JSON.parse(JSON.stringify(J.time));var M={year:"年",month:"月",day:"日"};if(Q){P[L][N]=E(O)}else{P[L][N]=E(O.text())}if(N==="year"||N==="month"||N==="day"){n(P[L],N)}s.call(this,J.index,P,N,K)}function s(O,M,Q,P){var K=this.target.find('[role="timePicker"]');var S=["begin","end"];var J=S[O];var N=M[J];var L=K.eq(O).val();var R=A(this.options.format);if(R===0&&(!L||Q==="minute"||Q==="hour"||Q==="second"||u.test(L))){M[J].time=N.year+"-"+E(N.month)+"-"+E(N.day)+" "+E(N.hour)+":"+E(N.minute)+":"+E(N.second)}else{if(R===2&&(!L||Q==="minute"||Q==="hour"||t.test(L))){M[J].time=N.year+"-"+E(N.month)+"-"+E(N.day)+" "+E(N.hour)+":"+E(N.minute)}else{M[J].time=N.year+"-"+E(N.month)+"-"+E(N.day)}}if(this.options.isRange){var T=M.time.split(";");T[O]=M[J].time;if(f(T[0],T[1])&&K.eq(1-O).val()){T[1-O]=T[O];K.eq(1-O).val(T[1-O]);M=r.call(this,N,M);n(M[J])}M.time=T.join(";")}else{M.time=M[J].time}if(P!==false&&(Q==="year"||Q==="month"||Q==="day")){M=k.call(this,M);n(M[J])}if(Q==="year"||Q==="month"){g.call(this,M[J])}this.target.data("time",M);K.eq(O).val(M[J].time)}function g(J){if((J.year>this.maxDate.year)||(J.year==this.maxDate.year&&J.month>=this.maxDate.month)){$(".timeRangePicker-wrap .timePicker-next").removeClass("timePicker-next");return}if((J.year<this.minDate.year)||(J.year==this.minDate.year&&J.month<=this.minDate.month)){$(".timeRangePicker-wrap .timePicker-prev").removeClass("timePicker-prev");return}}function r(L,O){var N=A(this.options.format);var K=["begin","end"];var P=[["year","month","day","hour","minute","second"],["year","month","day"],["year","month","day","hour","minute"]];P=P[N];for(var J=0;J<K.length;J++){for(var M=0;M<P.length;M++){O[K[J]][P[M]]=L[P[M]]}}return O}function a(L){var J=$(".timePicker-content-date");var K=$(".timeRangePicker-wrap .timePicker-time-main");$(".timePicker-content-time").addClass("hide");J.find(".timePicker-main").addClass("hide");J.find(".timePicker-"+L+"-main").removeClass("hide");w.call(this);if(L==="day"){K.removeClass("hide")}else{K.addClass("hide")}}function w(P){var N=this.target.data("target");if(N!==0&&N!==1){return false}var K=c.call(this);var J=P?[P]:["year","month","day","hour","minute","second"];for(var O=0;O<J.length;O++){P=J[O];var Q=K.date[P];var L=$(".timePicker-"+P+"-list").find(".timePicker-item").not(".timePicker-disable");var M;if(!L.length){return false}L.removeClass("active");$.each(L,function(R,S){if(Number($(S).text())==Q){$(S).addClass("active");M=1;if(P==="minute"||P==="second"||P==="hour"){$(".timePicker-"+P+"-list-main .timePicker-select span").html(E(Q))}return false}});if(!M&&P==="day"){L.eq(0).addClass("active");I.call(this,L.eq(0),P)}}}function c(K){K=K||this.target.data("target");var J=this.target.find('[role="timePicker"]').eq(K);var L=["begin","end"];var M=this.target.data("time");return{index:K,$target:J,time:M,key:L[K],date:M[L[K]]}}function H(J){J.addClass("active").siblings(".timePicker-item").removeClass("active")}function F(M){var K=M.split(";");var L=o(K[0]);var J=o(K[1]);return[L,J]}function o(K){var L=K.split(" ");var N="",M="",J="",P="",O="",Q="";if(!j(K)){return false}if(L.length>1){var R=L[1].split(":");N=R[0];M=R[1];J=R.length>2?R[2]:0}else{N=M=J="00"}L=L[0].split("-");P=L[0];O=L[1];Q=L[2];return{year:P,month:O,day:Q,hour:N,minute:M,second:J,time:P+"-"+E(O)+"-"+E(Q)+" "+E(N)+":"+E(M)+":"+E(J)}}function l(){var M=new Date();var O=M.getMonth()+1;var N=M.getFullYear();var K=M.getDate();var J=M.getHours();var P=M.getMinutes();var L=M.getSeconds();return{month:O,year:N,day:K,hour:J,minute:P,second:L,time:N+"-"+E(O)+"-"+E(K)+" "+E(J)+":"+E(P)+":"+E(L)}}function E(J){return Number(J)>=10?J:"0"+Number(J)}function D(){var J="",N="",M="";for(var L=0;L<24;L++){J+='<div class="timePicker-item">'+E(L)+"</div>"}for(var K=0;K<60;K++){N+='<div class="timePicker-item">'+E(K)+"</div>";M+='<div class="timePicker-item">'+E(K)+"</div>"}return{h:J,m:N,s:M}}function f(K,J){return Date.parse(K)>Date.parse(J)}$.fn.timeRangePicker=function(J){return this.each(function(){new h($(this),J)})}}());$(function(){$(".J-timeRangePicker-3").timeRangePicker({isRange:true,minDate:"1980-10-22",maxDate:"1993-10-29"});$(".J-timeRangePicker").timeRangePicker({isRange:true});$(".J-timeRangePicker-1").timeRangePicker({isRange:true,format:"YYYY-MM-DD hh:mm"});$(".J-timeRangePicker-2").timeRangePicker({isRange:false,format:"YYYY-MM-DD",chooseDay:function(a){this.hidePicker()}})});